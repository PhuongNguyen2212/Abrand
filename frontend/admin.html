<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Admin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CKEditor 5 CDN -->
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js"></script>
    <!-- Mammoth.js CDN for Word file processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.8.0/mammoth.browser.min.js"></script>
</head>

<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API_URL = "https://api.giangkimhoan.com";
        const FALLBACK_IMAGE = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";

        const formatVND = (number) => {
            if (!number && number !== 0) return "";
            return new Intl.NumberFormat("vi-VN", {
                style: "currency",
                currency: "VND",
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(Math.round(number)).replace(/\s/g, '');
        };

        const parseVND = (input) => {
            if (!input) return 0;
            const cleaned = input.toString().replace(/[^\d]/g, "");
            return parseFloat(cleaned) || 0;
        };

        function ProductManagement({ setError, setSuccess, isProcessing, setIsProcessing }) {
            const [products, setProducts] = useState([]);
            const [filteredProducts, setFilteredProducts] = useState([]);
            const [modalOpen, setModalOpen] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [newProduct, setNewProduct] = useState({
                name: "", brand: "", type: "", material: "", originalPrice: "", salePrice: "", description: ""
            });
            const [selectedFiles, setSelectedFiles] = useState([]);
            const [mainImageIndex, setMainImageIndex] = useState(0);
            const [keepImages, setKeepImages] = useState(true);
            const [excelFile, setExcelFile] = useState(null);
            const [searchQuery, setSearchQuery] = useState("");
            const [filterBrand, setFilterBrand] = useState("");
            const [filterType, setFilterType] = useState("");
            const [uploadProgress, setUploadProgress] = useState(0);
            const [uploadStatus, setUploadStatus] = useState("");
            const [existingImages, setExistingImages] = useState([]);

            const availableBrands = ["Cartier", "Bvlgari", "Van Cleef & Arpels", "Chrome Hearts", "GKH Jewelry", "Louis Vuiton", "Chanel"];
            const availableTypes = ["Ring", "Necklace", "Bracelet", "Collar", "Earring"];
            const availableMaterials = ["Vàng 10k", "Vàng 18k", "Bạc", "Bạch kim"];
            const MAX_IMAGES = 4;

            useEffect(() => {
                fetchProducts();
            }, []);

            useEffect(() => {
                const filtered = products.filter(product =>
                    (product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        product.description.toLowerCase().includes(searchQuery.toLowerCase())) &&
                    (filterBrand ? product.brand === filterBrand : true) &&
                    (filterType ? product.type === filterType : true)
                );
                setFilteredProducts(filtered);
            }, [products, searchQuery, filterBrand, filterType]);

            const fetchProducts = async () => {
                try {
                    const token = sessionStorage.getItem("token");
                    const response = await fetch(`${API_URL}/api/products`, {
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`
                        },
                        mode: "cors",
                        cache: "no-cache"
                    });
                    if (!response.ok) throw new Error("Failed to fetch products");
                    const data = await response.json();
                    setProducts(data);
                } catch (err) {
                    setError(`Error fetching products: ${err.message}`);
                }
            };

            const handleSaveProduct = async (e) => {
                e.preventDefault();
                if (isProcessing) return;
                setIsProcessing(true);

                const { name, brand, type, material, originalPrice, salePrice, description } = newProduct;
                const parsedOriginalPrice = parseVND(originalPrice);
                const parsedSalePrice = salePrice ? parseVND(salePrice) : 0;
                const totalImages = (keepImages ? existingImages.length : 0) + selectedFiles.length;

                if (!name.trim()) {
                    setError("Product name is required");
                    setIsProcessing(false);
                    return;
                }
                if (!availableBrands.includes(brand)) {
                    setError("Invalid brand selected");
                    setIsProcessing(false);
                    return;
                }
                if (!availableTypes.includes(type)) {
                    setError("Invalid type selected");
                    setIsProcessing(false);
                    return;
                }
                if (!availableMaterials.includes(material)) {
                    setError("Invalid material selected");
                    setIsProcessing(false);
                    return;
                }
                if (isNaN(parsedOriginalPrice) || parsedOriginalPrice <= 0) {
                    setError("Original price must be a positive number");
                    setIsProcessing(false);
                    return;
                }
                if (salePrice && (isNaN(parsedSalePrice) || parsedSalePrice < 0)) {
                    setError("Sale price must be a non-negative number");
                    setIsProcessing(false);
                    return;
                }
                if (totalImages === 0) {
                    setError("At least one image is required");
                    setIsProcessing(false);
                    return;
                }
                if (totalImages > MAX_IMAGES) {
                    setError(`Total images cannot exceed ${MAX_IMAGES}`);
                    setIsProcessing(false);
                    return;
                }
                if (mainImageIndex >= totalImages) {
                    setError("Main image index is invalid");
                    setIsProcessing(false);
                    return;
                }

                const formData = new FormData();
                formData.append("name", name.trim());
                formData.append("brand", brand);
                formData.append("type", type);
                formData.append("material", material);
                formData.append("originalPrice", parsedOriginalPrice);
                formData.append("salePrice", parsedSalePrice);
                formData.append("description", description.trim());
                formData.append("mainImageIndex", mainImageIndex);
                selectedFiles.forEach((file, index) => {
                    formData.append(`images`, file);
                });
                if (editingProduct) {
                    formData.append("version", editingProduct.version || 0);
                    formData.append("keepImages", keepImages.toString());
                    existingImages.forEach((url, index) => {
                        formData.append(`existingImages[${index}]`, url);
                    });
                }

                try {
                    const token = sessionStorage.getItem("token");
                    const url = editingProduct ? `${API_URL}/api/products/${editingProduct.id}` : `${API_URL}/api/products`;
                    const method = editingProduct ? "PATCH" : "POST";

                    const response = await fetch(url, {
                        method,
                        headers: { Authorization: `Bearer ${token}` },
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        if (response.status === 404) {
                            setError("Product not found");
                        } else if (response.status === 401) {
                            setError("Session expired. Please log in again.");
                            handleLogout();
                        } else if (response.status === 409) {
                            setError("Product was modified by another user. Please refresh and try again.");
                        } else {
                            setError(`Error saving product: ${errorData.message || "Unknown error"}`);
                        }
                        throw new Error(errorData.message);
                    }

                    await fetchProducts();
                    setModalOpen(false);
                    setNewProduct({ name: "", brand: "", type: "", material: "", originalPrice: "", salePrice: "", description: "" });
                    setSelectedFiles([]);
                    setMainImageIndex(0);
                    setKeepImages(true);
                    setEditingProduct(null);
                    setExistingImages([]);
                    setSuccess(editingProduct ? "Product updated successfully" : "Product added successfully");
                } catch (err) {
                    console.error("Error saving product:", err);
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleExcelUpload = async (e) => {
                e.preventDefault();
                if (!excelFile || isProcessing) return;
                setIsProcessing(true);
                setUploadProgress(0);
                setUploadStatus("Uploading...");

                if (!/application\/vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet|application\/vnd\.ms-excel/.test(excelFile.type)) {
                    setError("Please upload a valid Excel file (.xlsx, .xls)");
                    setExcelFile(null);
                    setUploadStatus("");
                    setIsProcessing(false);
                    return;
                }

                if (excelFile.size > 25 * 1024 * 1024) {
                    setError("File size exceeds 25MB limit. Try removing unnecessary rows/columns, saving as a compressed .xlsx format, or splitting the file into smaller parts.");
                    setExcelFile(null);
                    setUploadStatus("");
                    setIsProcessing(false);
                    return;
                }

                const formData = new FormData();
                formData.append("excel", excelFile);

                try {
                    const token = sessionStorage.getItem("token");
                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", `${API_URL}/api/upload-excel`, true);
                    xhr.setRequestHeader("Authorization", `Bearer ${token}`);

                    xhr.upload.onprogress = (event) => {
                        if (event.lengthComputable) {
                            const percentComplete = Math.round((event.loaded / event.total) * 100);
                            setUploadProgress(percentComplete);
                        }
                    };

                    xhr.onload = async () => {
                        if (xhr.status === 201) {
                            setUploadStatus("Processing complete!");
                            await fetchProducts();
                            setExcelFile(null);
                            setSuccess("Excel file processed successfully");
                        } else {
                            const errorData = JSON.parse(xhr.responseText);
                            setUploadStatus("Upload failed");
                            setError(`Error uploading Excel: ${errorData.message || "Unknown error"} (Status: ${xhr.status})`);
                        }
                        setIsProcessing(false);
                    };

                    xhr.onerror = () => {
                        setUploadStatus("Upload failed");
                        setError("Error uploading Excel: Network error");
                        setIsProcessing(false);
                    };

                    xhr.send(formData);
                } catch (err) {
                    setUploadStatus("Upload failed");
                    setError(`Error uploading Excel: ${err.message}`);
                    setIsProcessing(false);
                }
            };

            const handleDeleteProduct = async (productId) => {
                if (isProcessing || !confirm(`Are you sure you want to delete product with ID ${productId}?`)) return;
                setIsProcessing(true);
                setError('');
                setSuccess('');

                try {
                    const token = sessionStorage.getItem('token');
                    if (!token) {
                        setError('Session expired. Please log in again.');
                        handleLogout();
                        return;
                    }

                    if (!productId || typeof productId !== 'string' || productId.trim() === '') {
                        setError('Invalid product ID');
                        return;
                    }

                    const response = await fetch(`${API_URL}/api/products/${encodeURIComponent(productId.trim())}`, {
                        method: 'DELETE',
                        headers: { Authorization: `Bearer ${token}` }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        if (response.status === 401) {
                            setError('Session expired. Please log in again.');
                            handleLogout();
                        } else if (response.status === 404) {
                            setError(`Product with ID ${productId} not found. Please refresh the product list.`);
                        } else if (response.status === 400) {
                            setError(errorData.message || 'Invalid request. Check product ID.');
                        } else {
                            setError(errorData.message || 'Error deleting product');
                        }
                        throw new Error(errorData.message || 'Failed to delete product');
                    }

                    await fetchProducts();
                    setSuccess(`Product with ID ${productId} deleted successfully`);
                } catch (err) {
                    console.error('Error deleting product:', err.message);
                } finally {
                    setIsProcessing(false);
                }
            };

            const openEditModal = (product) => {
                setEditingProduct(product);
                setNewProduct({
                    name: product.name,
                    brand: product.brand,
                    type: product.type,
                    material: product.material,
                    originalPrice: formatVND(product.originalPrice),
                    salePrice: formatVND(product.salePrice),
                    description: product.description || ""
                });
                setSelectedFiles([]);
                setMainImageIndex(product.mainImageIndex || 0);
                setKeepImages(true);
                setExistingImages(product.imageUrls || []);
                setModalOpen(true);
            };

            const removeExistingImage = (index) => {
                const newImages = existingImages.filter((_, i) => i !== index);
                if (newImages.length === 0 && selectedFiles.length === 0) {
                    setError("At least one image is required");
                    return;
                }
                setExistingImages(newImages);
                if (mainImageIndex === index) {
                    setMainImageIndex(0);
                } else if (mainImageIndex > index) {
                    setMainImageIndex(mainImageIndex - 1);
                }
            };

            const removeSelectedFile = (index) => {
                const newFiles = selectedFiles.filter((_, i) => i !== index);
                const totalImages = (keepImages ? existingImages.length : 0) + newFiles.length;
                if (totalImages === 0) {
                    setError("At least one image is required");
                    return;
                }
                setSelectedFiles(newFiles);
                if (mainImageIndex >= existingImages.length && mainImageIndex - existingImages.length === index) {
                    setMainImageIndex(existingImages.length);
                }
            };

            const handleImageChange = (index, event) => {
                const file = event.target.files[0];
                if (!file) return;

                const remainingSlots = MAX_IMAGES - (keepImages ? existingImages.length : 0) - selectedFiles.length + 1;
                if (remainingSlots <= 0) {
                    setError(`Cannot add more than ${MAX_IMAGES} images`);
                    return;
                }

                const newFiles = [...selectedFiles];
                newFiles[index] = file;
                setSelectedFiles(newFiles.filter(f => f));
                if (mainImageIndex >= existingImages.length && mainImageIndex - existingImages.length >= newFiles.length) {
                    setMainImageIndex(existingImages.length);
                }
            };

            return (
                <div className="container mx-auto p-6 max-w-7xl">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-white p-6 rounded-lg shadow-lg">
                            <h3 className="text-xl font-semibold mb-4">Upload Excel</h3>
                            <form onSubmit={handleExcelUpload}>
                                <input
                                    type="file"
                                    accept=".xlsx,.xls"
                                    onChange={(e) => {
                                        setExcelFile(e.target.files[0]);
                                        setUploadStatus("");
                                        setUploadProgress(0);
                                    }}
                                    className="w-full p-2 border rounded-lg mb-4"
                                    disabled={isProcessing}
                                />
                                {uploadStatus && (
                                    <div className="mb-4">
                                        <p className="text-sm text-gray-600">{uploadStatus}</p>
                                        {uploadProgress > 0 && (
                                            <div className="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                                                <div
                                                    className="bg-blue-600 h-2.5 rounded-full"
                                                    style={{ width: `${uploadProgress}%` }}
                                                ></div>
                                            </div>
                                        )}
                                    </div>
                                )}
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 disabled:bg-blue-300 transition"
                                    disabled={isProcessing || !excelFile}
                                >
                                    {isProcessing ? "Uploading..." : "Upload Excel"}
                                </button>
                            </form>
                        </div>

                        <div className="bg-white p-6 rounded-lg shadow-lg md:col-span-2">
                            <h3 className="text-xl font-semibold mb-4">Filters</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input
                                    type="text"
                                    placeholder="Search by name or description..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <select
                                    value={filterBrand}
                                    onChange={(e) => setFilterBrand(e.target.value)}
                                    className="p-2 border rounded-lg"
                                >
                                    <option value="">All Brands</option>
                                    {availableBrands.map(brand => (
                                        <option key={brand} value={brand}>{brand}</option>
                                    ))}
                                </select>
                                <select
                                    value={filterType}
                                    onChange={(e) => setFilterType(e.target.value)}
                                    className="p-2 border rounded-lg"
                                >
                                    <option value="">All Types</option>
                                    {availableTypes.map(type => (
                                        <option key={type} value={type}>{type}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-lg shadow-lg">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-semibold">Products</h3>
                            <button
                                onClick={() => {
                                    setEditingProduct(null);
                                    setNewProduct({ name: "", brand: "", type: "", material: "", originalPrice: "", salePrice: "", description: "" });
                                    setSelectedFiles([]);
                                    setMainImageIndex(0);
                                    setKeepImages(true);
                                    setExistingImages([]);
                                    setModalOpen(true);
                                }}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                            >
                                Add Product
                            </button>
                        </div>
                        <div className="overflow-x-auto max-h-[600px]">
                            <table className="w-full text-left">
                                <thead className="bg-gray-100 sticky top-0">
                                    <tr>
                                        <th className="p-3">ID</th>
                                        <th className="p-3">Images</th>
                                        <th className="p-3">Name</th>
                                        <th className="p-3">Description</th>
                                        <th className="p-3">Brand</th>
                                        <th className="p-3">Type</th>
                                        <th className="p-3">Material</th>
                                        <th className="p-3">Price</th>
                                        <th className="p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredProducts.map((product, index) => (
                                        <tr key={product.id} className={`border-b ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}`}>
                                            <td className="p-3">{product.id}</td>
                                            <td className="p-3">
                                                <div className="flex space-x-2">
                                                    {(product.imageUrls || []).map((url, i) => (
                                                        <img
                                                            key={i}
                                                            src={`${API_URL}${url}`}
                                                            alt={`Product ${i}`}
                                                            className={`w-12 h-12 object-cover rounded ${i === product.mainImageIndex ? 'border-2 border-blue-500' : ''}`}
                                                            onError={(e) => (e.target.src = FALLBACK_IMAGE)}
                                                        />
                                                    ))}
                                                </div>
                                            </td>
                                            <td className="p-3">{product.name}</td>
                                            <td className="p-3 max-w-xs truncate">{product.description || "No description"}</td>
                                            <td className="p-3">{product.brand}</td>
                                            <td className="p-3">{product.type}</td>
                                            <td className="p-3">{product.material}</td>
                                            <td className="p-3">{formatVND(product.salePrice || product.originalPrice)}</td>
                                            <td className="p-3 flex space-x-2">
                                                <button
                                                    onClick={() => openEditModal(product)}
                                                    className="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition"
                                                    disabled={isProcessing}
                                                >
                                                    Edit
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteProduct(product.id)}
                                                    className="bg-red-600 text-white px-3 py-1 rounded-lg hover:bg-red-700 transition"
                                                    disabled={isProcessing}
                                                >
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {modalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-[80%] flex flex-col max-h-[90vh]">
                                <h3 className="text-xl font-semibold mb-4">{editingProduct ? "Edit Product" : "Add Product"}</h3>
                                <form onSubmit={handleSaveProduct} className="space-y-4 flex-grow overflow-y-auto pr-2">
                                    <input
                                        type="text"
                                        placeholder="Product Name"
                                        value={newProduct.name}
                                        onChange={(e) => setNewProduct({ ...newProduct, name: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    />
                                    <textarea
                                        placeholder="Product Description"
                                        value={newProduct.description}
                                        onChange={(e) => setNewProduct({ ...newProduct, description: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        rows="4"
                                    />
                                    <select
                                        value={newProduct.brand}
                                        onChange={(e) => setNewProduct({ ...newProduct, brand: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    >
                                        <option value="">Select Brand</option>
                                        {availableBrands.map(brand => (
                                            <option key={brand} value={brand}>{brand}</option>
                                        ))}
                                    </select>
                                    <select
                                        value={newProduct.type}
                                        onChange={(e) => setNewProduct({ ...newProduct, type: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    >
                                        <option value="">Select Type</option>
                                        {availableTypes.map(type => (
                                            <option key={type} value={type}>{type}</option>
                                        ))}
                                    </select>
                                    <select
                                        value={newProduct.material}
                                        onChange={(e) => setNewProduct({ ...newProduct, material: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    >
                                        <option value="">Select Material</option>
                                        {availableMaterials.map(material => (
                                            <option key={material} value={material}>{material}</option>
                                        ))}
                                    </select>
                                    <input
                                        type="text"
                                        placeholder="Original Price (VND)"
                                        value={newProduct.originalPrice}
                                        onChange={(e) => setNewProduct({ ...newProduct, originalPrice: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    />
                                    <input
                                        type="text"
                                        placeholder="Sale Price (VND)"
                                        value={newProduct.salePrice}
                                        onChange={(e) => setNewProduct({ ...newProduct, salePrice: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                    />
                                    {editingProduct && (
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={keepImages}
                                                onChange={(e) => {
                                                    setKeepImages(e.target.checked);
                                                    if (e.target.checked) {
                                                        setExistingImages(editingProduct.imageUrls || []);
                                                    } else {
                                                        setExistingImages([]);
                                                    }
                                                }}
                                                className="mr-2"
                                            />
                                            Keep Existing Images
                                        </label>
                                    )}
                                    <div className="space-y-2">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Product Images (Max 4)</label>
                                        <div className="grid grid-cols-4 gap-4">
                                            {[0, 1, 2, 3].map((index) => {
                                                const image = (keepImages ? existingImages[index] : null) || selectedFiles[index];
                                                const isMain = index === mainImageIndex;
                                                const isExisting = keepImages && index < existingImages.length;
                                                const isSelected = index < selectedFiles.length;

                                                return (
                                                    <div key={index} className="relative border-2 border-dashed border-gray-300 rounded-lg p-2 h-72 flex flex-col items-center justify-center">
                                                        {image ? (
                                                            <>
                                                                <img
                                                                    src={isExisting ? `${API_URL}${image}` : URL.createObjectURL(image)}
                                                                    alt={`Image ${index + 1}`}
                                                                    className={`w-full h-64 object-contain rounded ${isMain ? 'border-2 border-blue-500' : ''}`}
                                                                    onError={(e) => (e.target.src = FALLBACK_IMAGE)}
                                                                />
                                                                <input
                                                                    type="radio"
                                                                    name="mainImage"
                                                                    checked={isMain}
                                                                    onChange={() => setMainImageIndex(index)}
                                                                    className="absolute top-2 left-2"
                                                                />
                                                                <button
                                                                    type="button"
                                                                    onClick={() => isExisting ? removeExistingImage(index) : removeSelectedFile(index)}
                                                                    className="absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center"
                                                                >
                                                                    X
                                                                </button>
                                                            </>
                                                        ) : (
                                                            <>
                                                                <input
                                                                    type="file"
                                                                    accept="image/jpeg,image/jpg,image/png"
                                                                    onChange={(e) => handleImageChange(index, e)}
                                                                    className="absolute inset-0 opacity-0 cursor-pointer"
                                                                    disabled={(keepImages ? existingImages.length : 0) + selectedFiles.length >= MAX_IMAGES}
                                                                />
                                                                <span className="text-gray-400 text-sm">Upload Image</span>
                                                            </>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div className="text-sm text-gray-600 mt-2">
                                            Total images: {(keepImages ? existingImages.length : 0) + selectedFiles.length}/{MAX_IMAGES}
                                        </div>
                                    </div>
                                </form>
                                <div className="flex justify-end space-x-2 mt-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setModalOpen(false);
                                            setKeepImages(true);
                                            setSelectedFiles([]);
                                            setMainImageIndex(0);
                                            setExistingImages([]);
                                        }}
                                        className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        onClick={handleSaveProduct}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                        disabled={isProcessing}
                                    >
                                        {isProcessing ? "Saving..." : "Save"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function NewsManagement({ setError, setSuccess, isProcessing, setIsProcessing, handleLogout, currentPage }) {
            const [news, setNews] = useState([]);
            const [filteredNews, setFilteredNews] = useState([]);
            const [modalOpen, setModalOpen] = useState(false);
            const [previewOpen, setPreviewOpen] = useState(false);
            const [editingNews, setEditingNews] = useState(null);
            const [previewNews, setPreviewNews] = useState(null);
            const [newNews, setNewNews] = useState({
                title: "",
                content: ""
            });
            const [selectedImage, setSelectedImage] = useState(null);
            const [existingImage, setExistingImage] = useState(null);
            const [keepImage, setKeepImage] = useState(true);
            const [selectedWordFile, setSelectedWordFile] = useState(null);
            const [searchQuery, setSearchQuery] = useState("");
            const [editorError, setEditorError] = useState(null);
            const editorRef = useRef(null);

            useEffect(() => {
                fetchNews();
                return () => {
                    if (editorRef.current) {
                        editorRef.current.destroy().catch(err => console.error('Error destroying CKEditor:', err));
                        editorRef.current = null;
                    }
                };
            }, []);

            useEffect(() => {
                const filtered = news.filter(item =>
                    item.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    item.content.toLowerCase().replace(/<[^>]+>/g, '').includes(searchQuery.toLowerCase())
                );
                setFilteredNews(filtered);
            }, [news, searchQuery]);

            useEffect(() => {
                if (modalOpen && !editorRef.current && currentPage === 'news') {
                    console.log('Attempting to initialize CKEditor');
                    const token = sessionStorage.getItem('token');
                    if (!token) {
                        console.warn('No token found, logging out');
                        setError('No authentication token found. Please log in again.');
                        handleLogout();
                        return;
                    }
                    const initializeEditor = async () => {
                        try {
                            console.log('Verifying token');
                            const response = await fetch(`${API_URL}/api/verify-token`, {
                                headers: { Authorization: `Bearer ${token}` }
                            });
                            if (!response.ok) {
                                throw new Error(`Token verification failed: ${response.status}`);
                            }
                            const data = await response.json();
                            if (!data.valid) {
                                console.warn('Invalid token, logging out');
                                setError('Session expired. Please log in again.');
                                handleLogout();
                                return;
                            }
                            console.log('Token verified, initializing CKEditor');
                            const editor = await ClassicEditor.create(document.querySelector('#editor'), {
                                toolbar: {
                                    items: [
                                        'heading', '|',
                                        'bold', 'italic', 'link', 'bulletedList', 'numberedList', '|',
                                        'outdent', 'indent', '|',
                                        'uploadImage', 'blockQuote', 'insertTable', 'mediaEmbed', 'undo', 'redo'
                                    ]
                                },
                                image: {
                                    toolbar: [
                                        'imageStyle:inline',
                                        'imageStyle:block',
                                        'imageStyle:side',
                                        '|',
                                        'toggleImageCaption',
                                        'imageTextAlternative'
                                    ]
                                }
                            });
                            editorRef.current = editor;
                            editor.setData(newNews.content);
                            editor.model.document.on('change:data', () => {
                                setNewNews({ ...newNews, content: editor.getData() });
                            });

                            editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {
                                return {
                                    upload: async () => {
                                        const file = await loader.file;
                                        if (!file) {
                                            throw new Error('No file selected for upload');
                                        }
                                        const formData = new FormData();
                                        formData.append('upload', file);
                                        console.log('Uploading image:', file.name);
                                        try {
                                            const response = await fetch(`${API_URL}/api/upload-image`, {
                                                method: 'POST',
                                                headers: {
                                                    Authorization: `Bearer ${token}`
                                                },
                                                body: formData
                                            });
                                            if (!response.ok) {
                                                const errorData = await response.json();
                                                throw new Error(errorData.error?.message || `Upload failed: ${response.status}`);
                                            }
                                            const data = await response.json();
                                            const fullUrl = `${API_URL}${data.url}`;
                                            console.log('Image upload successful:', fullUrl);
                                            return { default: fullUrl };
                                        } catch (error) {
                                            console.error('Image upload error:', error.message);
                                            throw new Error(`Cannot upload file: ${error.message}`);
                                        }
                                    },
                                    abort: () => {
                                        console.log('Image upload aborted');
                                    }
                                };
                            };
                        } catch (error) {
                            console.error('Error initializing CKEditor or verifying token:', error.message);
                            setEditorError(`Failed to initialize editor: ${error.message}`);
                        }
                    };
                    initializeEditor();
                }
            }, [modalOpen, newNews, currentPage, setError, handleLogout]);

            const handleWordFileUpload = (e) => {
                const file = e.target.files[0];
                setSelectedWordFile(file);
                if (file && editorRef.current) {
                    if (!/application\/msword|application\/vnd\.openxmlformats-officedocument\.wordprocessingml\.document/.test(file.type)) {
                        setError("Please upload a valid Word file (.doc, .docx)");
                        setSelectedWordFile(null);
                        return;
                    }
                    if (file.size > 10 * 1024 * 1024) {
                        setError("Word file size exceeds 10MB limit");
                        setSelectedWordFile(null);
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        try {
                            const result = await mammoth.convertToHtml({ arrayBuffer: event.target.result });
                            const htmlContent = result.value;
                            setNewNews({ ...newNews, content: htmlContent });
                            if (editorRef.current) {
                                editorRef.current.setData(htmlContent);
                            }
                        } catch (err) {
                            setError(`Error processing Word file: ${err.message}`);
                            setSelectedWordFile(null);
                        }
                    };
                    reader.onerror = () => {
                        setError("Error reading Word file");
                        setSelectedWordFile(null);
                    };
                    reader.readAsArrayBuffer(file);
                }
            };

            const fetchNews = async () => {
                try {
                    const token = sessionStorage.getItem("token");
                    const response = await fetch(`${API_URL}/api/news`, {
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`
                        },
                        mode: "cors",
                        cache: "no-cache"
                    });
                    if (!response.ok) throw new Error("Failed to fetch news");
                    const data = await response.json();
                    setNews(data);
                } catch (err) {
                    setError(`Error fetching news: ${err.message}`);
                }
            };

            const handleSaveNews = async (e) => {
                e.preventDefault();
                if (isProcessing) return;
                setIsProcessing(true);

                const { title, content } = newNews;

                if (!title.trim()) {
                    setError("News title is required");
                    setIsProcessing(false);
                    return;
                }
                if (!content.trim() || content === '<p></p>') {
                    setError("News content is required");
                    setIsProcessing(false);
                    return;
                }

                const formData = new FormData();
                formData.append("title", title.trim());
                formData.append("content", content.trim());
                if (selectedImage) {
                    formData.append("image", selectedImage);
                }
                if (editingNews) {
                    formData.append("version", editingNews.version || 0);
                    formData.append("keepImage", keepImage.toString());
                    if (keepImage && existingImage) {
                        formData.append("existingImage", existingImage);
                    }
                }

                try {
                    const token = sessionStorage.getItem("token");
                    const url = editingNews ? `${API_URL}/api/news/${editingNews.id}` : `${API_URL}/api/news`;
                    const method = editingNews ? "PATCH" : "POST";

                    const response = await fetch(url, {
                        method,
                        headers: { Authorization: `Bearer ${token}` },
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        if (response.status === 404) {
                            setError("News article not found");
                        } else if (response.status === 401) {
                            setError("Session expired. Please log in again.");
                            handleLogout();
                        } else if (response.status === 409) {
                            setError("News article was modified by another user. Please refresh and try again.");
                        } else {
                            setError(`Error saving news: ${errorData.message || "Unknown error"}`);
                        }
                        throw new Error(errorData.message);
                    }

                    await fetchNews();
                    setModalOpen(false);
                    setNewNews({ title: "", content: "" });
                    setSelectedImage(null);
                    setExistingImage(null);
                    setKeepImage(true);
                    setSelectedWordFile(null);
                    setEditingNews(null);
                    if (editorRef.current) {
                        editorRef.current.destroy().catch(err => console.error('Error destroying CKEditor:', err));
                        editorRef.current = null;
                    }
                    setSuccess(editingNews ? "News updated successfully" : "News added successfully");
                } catch (err) {
                    console.error("Error saving news:", err);
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleDeleteNews = async (newsId) => {
                if (isProcessing || !confirm(`Are you sure you want to delete news article with ID ${newsId}?`)) return;
                setIsProcessing(true);
                setError('');
                setSuccess('');

                try {
                    const token = sessionStorage.getItem("token");
                    const response = await fetch(`${API_URL}/api/news/${encodeURIComponent(newsId.trim())}`, {
                        method: "DELETE",
                        headers: { Authorization: `Bearer ${token}` }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        if (response.status === 401) {
                            setError("Session expired. Please log in again.");
                            handleLogout();
                        } else if (response.status === 404) {
                            setError(`News article with ID ${newsId} not found. Please refresh the news list.`);
                        } else {
                            setError(errorData.message || "Error deleting news article");
                        }
                        throw new Error(errorData.message || "Failed to delete news article");
                    }

                    await fetchNews();
                    setSuccess(`News article with ID ${newsId} deleted successfully`);
                } catch (err) {
                    console.error("Error deleting news:", err.message);
                } finally {
                    setIsProcessing(false);
                }
            };

            const openEditModal = (newsItem) => {
                setEditingNews(newsItem);
                setNewNews({
                    title: newsItem.title,
                    content: newsItem.content
                });
                setSelectedImage(null);
                setExistingImage(newsItem.imageUrl || null);
                setKeepImage(true);
                setSelectedWordFile(null);
                setModalOpen(true);
            };

            const openPreviewModal = (newsItem) => {
                setPreviewNews(newsItem);
                setPreviewOpen(true);
            };

            if (editorError) {
                return (
                    <div className="container mx-auto p-6 max-w-7xl">
                        <div className="bg-red-100 text-red-700 p-4 rounded-lg">
                            {editorError}
                            <button
                                onClick={() => {
                                    setEditorError(null);
                                    fetchNews();
                                }}
                                className="ml-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container mx-auto p-6 max-w-7xl">
                    <div className="bg-white p-6 rounded-lg shadow-lg mb-8">
                        <h3 className="text-xl font-semibold mb-4">Filters</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input
                                type="text"
                                placeholder="Search by title or content..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-lg shadow-lg">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-semibold">News Articles</h3>
                            <button
                                onClick={() => {
                                    setEditingNews(null);
                                    setNewNews({ title: "", content: "" });
                                    setSelectedImage(null);
                                    setExistingImage(null);
                                    setKeepImage(true);
                                    setSelectedWordFile(null);
                                    setModalOpen(true);
                                }}
                                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                            >
                                Add News
                            </button>
                        </div>
                        <div className="overflow-x-auto max-h-[600px]">
                            <table className="w-full text-left">
                                <thead className="bg-gray-100 sticky top-0 z-10">
                                    <tr>
                                        <th className="p-3 min-w-[100px]">ID</th>
                                        <th className="p-3 min-w-[120px]">Image</th>
                                        <th className="p-3 min-w-[200px]">Title</th>
                                        <th className="p-3 min-w-[300px]">Content Preview</th>
                                        <th className="p-3 min-w-[150px]">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredNews.length === 0 ? (
                                        <tr>
                                            <td colSpan="5" className="p-3 text-center text-gray-500">
                                                No news articles found
                                            </td>
                                        </tr>
                                    ) : (
                                        filteredNews.map((newsItem, index) => (
                                            <tr key={newsItem.id} className={`border-b ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}`}>
                                                <td className="p-3">{newsItem.id}</td>
                                                <td className="p-3">
                                                    {newsItem.imageUrl ? (
                                                        <img
                                                            src={`${API_URL}${newsItem.imageUrl}`}
                                                            alt="News"
                                                            className="w-12 h-12 object-cover rounded"
                                                            onError={(e) => (e.target.src = FALLBACK_IMAGE)}
                                                        />
                                                    ) : (
                                                        <span>No Image</span>
                                                    )}
                                                </td>
                                                <td className="p-3 break-words">{newsItem.title}</td>
                                                <td className="p-3 break-words max-w-[300px]">
                                                    <div
                                                        dangerouslySetInnerHTML={{
                                                            __html: newsItem.content.substring(0, 100) + (newsItem.content.length > 100 ? "..." : "")
                                                        }}
                                                    />
                                                </td>
                                                <td className="p-3 flex space-x-2">
                                                    <button
                                                        onClick={() => openPreviewModal(newsItem)}
                                                        className="bg-green-500 text-white px-3 py-1 rounded-lg hover:bg-green-600 transition"
                                                        disabled={isProcessing}
                                                    >
                                                        View
                                                    </button>
                                                    <button
                                                        onClick={() => openEditModal(newsItem)}
                                                        className="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition"
                                                        disabled={isProcessing}
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeleteNews(newsItem.id)}
                                                        className="bg-red-600 text-white px-3 py-1 rounded-lg hover:bg-red-700 transition"
                                                        disabled={isProcessing}
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {modalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-[80%] flex flex-col max-h-[90vh]">
                                <h3 className="text-xl font-semibold mb-4">{editingNews ? "Edit News" : "Add News"}</h3>
                                <form onSubmit={handleSaveNews} className="space-y-4 flex-grow overflow-y-auto pr-2">
                                    <input
                                        type="text"
                                        placeholder="News Title"
                                        value={newNews.title}
                                        onChange={(e) => setNewNews({ ...newNews, title: e.target.value })}
                                        className="w-full p-2 border rounded-lg"
                                        required
                                    />
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Upload Word File</label>
                                        <input
                                            type="file"
                                            accept=".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                                            onChange={handleWordFileUpload}
                                            className="w-full p-2 border rounded-lg"
                                            disabled={isProcessing}
                                        />
                                        {selectedWordFile && (
                                            <div className="mt-2 text-sm text-gray-600">
                                                Selected: {selectedWordFile.name}
                                                <button
                                                    type="button"
                                                    onClick={() => setSelectedWordFile(null)}
                                                    className="ml-2 text-red-600 hover:text-red-800"
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Main Content</label>
                                        <textarea id="editor" className="w-full border rounded-lg" style={{ minHeight: '200px' }}></textarea>
                                    </div>
                                    {editingNews && (
                                        <div className="space-y-2">
                                            <label className="flex items-center">
                                                <input
                                                    type="checkbox"
                                                    checked={keepImage}
                                                    onChange={(e) => {
                                                        setKeepImage(e.target.checked);
                                                        if (!e.target.checked) {
                                                            setExistingImage(null);
                                                        }
                                                    }}
                                                    className="mr-2"
                                                />
                                                Keep Existing Image
                                            </label>
                                            {(keepImage && existingImage) && (
                                                <div className="relative">
                                                    <img
                                                        src={`${API_URL}${existingImage}`}
                                                        alt="Existing News"
                                                        className="w-24 h-24 object-cover rounded"
                                                        onError={(e) => (e.target.src = FALLBACK_IMAGE)}
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => setExistingImage(null)}
                                                        className="absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center"
                                                    >
                                                        X
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                    <div className="space-y-2">
                                        <input
                                            type="file"
                                            accept="image/jpeg,image/jpg,image/png"
                                            onChange={(e) => setSelectedImage(e.target.files[0])}
                                            className="w-full p-2 border rounded-lg"
                                            disabled={keepImage && existingImage}
                                        />
                                        {selectedImage && (
                                            <div className="relative">
                                                <img
                                                    src={URL.createObjectURL(selectedImage)}
                                                    alt="Preview"
                                                    className="w-24 h-24 object-cover rounded"
                                                />
                                                <button
                                                    type="button"
                                                    onClick={() => setSelectedImage(null)}
                                                    className="absolute top-2 right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center"
                                                >
                                                    X
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </form>
                                <div className="flex justify-end space-x-2 mt-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setModalOpen(false);
                                            setNewNews({ title: "", content: "" });
                                            setSelectedImage(null);
                                            setExistingImage(null);
                                            setKeepImage(true);
                                            setSelectedWordFile(null);
                                            if (editorRef.current) {
                                                editorRef.current.destroy().catch(err => console.error('Error destroying CKEditor:', err));
                                                editorRef.current = null;
                                            }
                                        }}
                                        className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        onClick={handleSaveNews}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                        disabled={isProcessing}
                                    >
                                        {isProcessing ? "Saving..." : "Save"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {previewOpen && previewNews && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl flex flex-col max-h-[90vh]">
                                <h3 className="text-xl font-semibold mb-4">News Preview: {previewNews.title}</h3>
                                <div className="flex flex-col md:flex-row gap-6 overflow-y-auto pr-2">
                                    {previewNews.imageUrl && (
                                        <img
                                            src={`${API_URL}${previewNews.imageUrl}`}
                                            alt={previewNews.title}
                                            className="w-full md:w-1/3 h-64 object-cover rounded-lg mb-4 md:mb-0"
                                            onError={(e) => (e.target.src = FALLBACK_IMAGE)}
                                        />
                                    )}
                                    <div className="flex-1">
                                        <div
                                            className="text-gray-700 prose prose-sm max-w-none"
                                            dangerouslySetInnerHTML={{ __html: previewNews.content }}
                                        />
                                    </div>
                                </div>
                                <div className="flex justify-end space-x-2 mt-6">
                                    <button
                                        type="button"
                                        onClick={() => setPreviewOpen(false)}
                                        className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"
                                    >
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [username, setUsername] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");
            const [success, setSuccess] = useState("");
            const [isProcessing, setIsProcessing] = useState(false);
            const [currentPage, setCurrentPage] = useState("products");

            useEffect(() => {
                if (success || error) {
                    const timer = setTimeout(() => {
                        setSuccess("");
                        setError("");
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [success, error]);

            useEffect(() => {
                const loggedIn = sessionStorage.getItem("isLoggedIn");
                if (loggedIn === "true" && sessionStorage.getItem("token")) {
                    setIsLoggedIn(true);
                }
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(`${API_URL}/api/login`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ username, password })
                    });
                    const data = await response.json();
                    if (data.success) {
                        setIsLoggedIn(true);
                        sessionStorage.setItem("isLoggedIn", "true");
                        sessionStorage.setItem("token", data.token);
                    } else {
                        setError(data.message || "Invalid credentials");
                    }
                } catch (err) {
                    setError(`Login failed: ${err.message}`);
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                sessionStorage.clear();
                setUsername("");
                setPassword("");
                setCurrentPage("products");
            };

            if (!isLoggedIn) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600">
                        <div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">Admin Login</h2>
                            {error && (
                                <div className="bg-red-100 text-red-700 p-4 rounded mb-4">{error}</div>
                            )}
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Username"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <input
                                    type="password"
                                    placeholder="Password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition"
                                >
                                    Login
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    <nav className="bg-gray-800 text-white p-4">
                        <div className="container mx-auto flex justify-between items-center">
                            <h2 className="text-2xl font-bold">Admin Dashboard</h2>
                            <div className="flex space-x-4">
                                <button
                                    onClick={() => setCurrentPage("products")}
                                    className={`px-4 py-2 rounded-lg ${currentPage === "products" ? "bg-blue-600" : "bg-gray-600"} hover:bg-blue-700 transition`}
                                >
                                    Products
                                </button>
                                <button
                                    onClick={() => setCurrentPage("news")}
                                    className={`px-4 py-2 rounded-lg ${currentPage === "news" ? "bg-blue-600" : "bg-gray-600"} hover:bg-blue-700 transition`}
                                >
                                    News
                                </button>
                                <button
                                    onClick={handleLogout}
                                    className="bg-red-600 px-4 py-2 rounded-lg hover:bg-red-700 transition"
                                >
                                    Logout
                                </button>
                            </div>
                        </div>
                    </nav>
                    {(error || success) && (
                        <div className={`container mx-auto p-6 max-w-7xl ${error ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'} p-4 rounded-lg mb-6`}>
                            {error || success}
                        </div>
                    )}
                    {currentPage === "products" ? (
                        <ProductManagement
                            setError={setError}
                            setSuccess={setSuccess}
                            isProcessing={isProcessing}
                            setIsProcessing={setIsProcessing}
                        />
                    ) : (
                        <NewsManagement
                            setError={setError}
                            setSuccess={setSuccess}
                            isProcessing={isProcessing}
                            setIsProcessing={setIsProcessing}
                            handleLogout={handleLogout}
                            currentPage={currentPage}
                        />
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>

</html>